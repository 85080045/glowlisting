# 用户认证系统说明

## ✅ 已完成的功能

### 1. 用户注册和登录
- ✅ 用户注册页面
- ✅ 用户登录页面
- ✅ JWT Token 认证
- ✅ 密码加密存储（bcrypt）

### 2. Token 管理系统
- ✅ 新用户注册送 5 个 token
- ✅ 右上角实时显示剩余 token
- ✅ 每次增强图片消耗 1 个 token
- ✅ Token 不足时提示用户

### 3. 用户界面
- ✅ 登录/注册页面
- ✅ 用户仪表板（Dashboard）
- ✅ 用户信息显示
- ✅ 使用统计（已处理总数、已使用次数等）

### 4. 后端 API
- ✅ `/api/auth/register` - 用户注册
- ✅ `/api/auth/login` - 用户登录
- ✅ `/api/auth/me` - 获取当前用户信息
- ✅ `/api/enhance` - 图片增强（支持 token 验证）

## 📦 安装新依赖

### 前端依赖
```bash
npm install react-router-dom
```

### 后端依赖
```bash
cd server
npm install bcryptjs jsonwebtoken dotenv
```

## 🚀 启动步骤

### 1. 安装依赖
```bash
# 前端
npm install

# 后端
cd server
npm install
cd ..
```

### 2. 配置环境变量（可选）

创建 `server/.env` 文件：
```env
JWT_SECRET=your-secret-key-here
PORT=3001
AUTOENHANCE_API_KEY=your_api_key_here
```

### 3. 启动服务

**终端 1 - 前端：**
```bash
npm run dev
```

**终端 2 - 后端：**
```bash
cd server
npm run dev
```

## 🎯 使用说明

### 注册新用户
1. 访问 http://localhost:3000/login
2. 点击"还没有账户？立即注册"
3. 填写姓名、邮箱和密码
4. 注册成功后自动登录并跳转到 Dashboard
5. 新用户自动获得 5 个免费 token

### 登录
1. 访问 http://localhost:3000/login
2. 输入邮箱和密码
3. 登录成功后跳转到 Dashboard

### 使用图片增强
1. 登录后访问 Dashboard 或首页
2. 上传照片
3. 点击"开始 AI 增强"
4. 系统自动扣除 1 个 token
5. 右上角实时显示剩余 token

### 查看剩余 Token
- 右上角显示剩余 token 数量
- Dashboard 页面显示详细统计信息

## 🔒 安全特性

- 密码使用 bcrypt 加密存储
- JWT Token 认证（30天有效期）
- Token 验证中间件
- 自动检查 token 是否足够

## 📝 测试账户

系统默认创建一个测试账户：
- 邮箱：`test@example.com`
- 密码：`password123`
- 初始 token：10 个

## ⚠️ 注意事项

1. **生产环境**：请务必修改 `JWT_SECRET` 为强密码
2. **数据库**：当前使用内存存储，生产环境应使用真实数据库（如 MongoDB、PostgreSQL）
3. **Token 管理**：可以扩展购买 token 功能
4. **密码重置**：可以添加密码重置功能

## 🔄 下一步功能建议

- [ ] 购买 token 功能
- [ ] 密码重置
- [ ] 邮箱验证
- [ ] 用户资料编辑
- [ ] 使用历史记录
- [ ] 订阅计划管理


